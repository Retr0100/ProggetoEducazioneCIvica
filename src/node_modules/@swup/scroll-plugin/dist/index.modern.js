import t from"@swup/plugin";import{Location as o,queryAll as e,getCurrentUrl as s}from"swup";import n from"scrl";function i(){return i=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},i.apply(this,arguments)}class l extends t{constructor(t){super(),this.name="ScrollPlugin",this.getAnchorElement=(t="")=>"function"==typeof this.options.getAnchorElement?this.options.getAnchorElement(t):"function"==typeof this.swup.getAnchorElement?this.swup.getAnchorElement(t):document.querySelector(t),this.getOffset=(t=null)=>"function"==typeof this.options.offset?parseInt(this.options.offset(t),10):parseInt(this.options.offset,10),this.onSamePage=()=>{this.swup.scrollTo(0,this.shouldAnimate("samePage"))},this.onSamePageWithHash=t=>{this.maybeScrollToAnchor(t.delegateTarget.hash,"samePageWithHash")},this.onTransitionStart=t=>{this.options.doScrollingRightAway&&!this.swup.scrollToElement&&this.doScrollingBetweenPages(t)},this.onContentReplaced=t=>{this.options.doScrollingRightAway&&!this.swup.scrollToElement||this.doScrollingBetweenPages(t),this.restoreScrollContainers(t)},this.doScrollingBetweenPages=t=>{const o=this.swup;if(t&&!o.options.animateHistoryBrowsing)return;if(this.maybeScrollToAnchor(o.scrollToElement,"betweenPages"))return void(o.scrollToElement=null);const e=this.getStoredScrollPositions(this.getCurrentCacheKey())||{},s=e.window&&e.window.top||0;requestAnimationFrame(()=>o.scrollTo(s,this.shouldAnimate("betweenPages")))},this.onWillReplaceContent=()=>{this.storeScrollPositions(this.currentCacheKey),this.currentCacheKey=this.getCurrentCacheKey()},this.onClickLink=t=>{this.maybeResetScrollPositions(t.delegateTarget)},this.options=i({},{doScrollingRightAway:!1,animateScroll:{betweenPages:!0,samePageWithHash:!0,samePage:!0},scrollFriction:.3,scrollAcceleration:.04,getAnchorElement:null,offset:0,scrollContainers:"[data-swup-scroll-container]",shouldResetScrollPosition:t=>!0},t)}mount(){const t=this.swup;t._handlers.scrollDone=[],t._handlers.scrollStart=[],this.scrl=new n({onStart:()=>t.triggerEvent("scrollStart"),onEnd:()=>t.triggerEvent("scrollDone"),onCancel:()=>t.triggerEvent("scrollDone"),friction:this.options.scrollFriction,acceleration:this.options.scrollAcceleration}),t.scrollTo=(o,e=!0)=>{e?this.scrl.scrollTo(o):(t.triggerEvent("scrollStart"),window.scrollTo(0,o),t.triggerEvent("scrollDone"))},this.scrollPositionsStore={},this.currentCacheKey=this.getCurrentCacheKey(),this.previousScrollRestoration=window.history.scrollRestoration,t.options.animateHistoryBrowsing&&(window.history.scrollRestoration="manual"),t.on("samePage",this.onSamePage),t.on("samePageWithHash",this.onSamePageWithHash),t.on("transitionStart",this.onTransitionStart),t.on("contentReplaced",this.onContentReplaced),t.on("willReplaceContent",this.onWillReplaceContent),t.on("clickLink",this.onClickLink)}unmount(){const t=this.swup;t.scrollTo=null,delete this.scrl,this.scrl=null,t.off("samePage",this.onSamePage),t.off("samePageWithHash",this.onSamePageWithHash),t.off("transitionStart",this.onTransitionStart),t.off("contentReplaced",this.onContentReplaced),t.off("willReplaceContent",this.onWillReplaceContent),t.off("clickLink",this.onClickLink),t._handlers.scrollDone=null,t._handlers.scrollStart=null,window.history.scrollRestoration=this.previousScrollRestoration}shouldAnimate(t){return"boolean"==typeof this.options.animateScroll?this.options.animateScroll:this.options.animateScroll[t]}maybeScrollToAnchor(t,o){if(null==t)return!1;const e=this.getAnchorElement(t);if(!e)return console.warn(`Element ${t} not found`),!1;if(!(e instanceof Element))return console.warn(`Element ${t} is not a DOM node`),!1;const s=e.getBoundingClientRect().top+window.pageYOffset-this.getOffset(e);return this.swup.scrollTo(s,this.shouldAnimate(o)),!0}maybeResetScrollPositions(t){if(!this.options.shouldResetScrollPosition(t))return;const{url:e}=o.fromElement(t);this.resetScrollPositions(e)}storeScrollPositions(t){const o=e(this.options.scrollContainers).map(t=>({top:t.scrollTop,left:t.scrollLeft}));this.scrollPositionsStore[t]={window:{top:window.scrollY,left:window.scrollX},containers:o}}resetScrollPositions(t){const o=this.getResolvedUrl(t);delete this.scrollPositionsStore[o],this.scrollPositionsStore[o]=null}getStoredScrollPositions(t){const o=this.getResolvedUrl(t);return this.scrollPositionsStore[o]}restoreScrollContainers(t){const o=this.getStoredScrollPositions(this.getCurrentCacheKey())||{};null!=o.containers&&e(this.options.scrollContainers).forEach((t,e)=>{const s=o.containers[e];null!=s&&(t.scrollTop=s.top,t.scrollLeft=s.left)})}getCurrentCacheKey(){return this.getResolvedUrl(s())}getResolvedUrl(t){return"function"==typeof this.swup.resolveUrl?this.swup.resolveUrl(t):t}}export{l as default};
//# sourceMappingURL=index.modern.js.map
