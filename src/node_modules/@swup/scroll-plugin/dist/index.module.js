import t from"@swup/plugin";import{Location as o,queryAll as e,getCurrentUrl as s}from"swup";import n from"scrl";class i extends t{constructor(t){var o;super(),o=this,this.name="ScrollPlugin",this.getAnchorElement=function(t){return void 0===t&&(t=""),"function"==typeof o.options.getAnchorElement?o.options.getAnchorElement(t):"function"==typeof o.swup.getAnchorElement?o.swup.getAnchorElement(t):document.querySelector(t)},this.getOffset=function(t){return void 0===t&&(t=null),"function"==typeof o.options.offset?parseInt(o.options.offset(t),10):parseInt(o.options.offset,10)},this.onSamePage=()=>{this.swup.scrollTo(0,this.shouldAnimate("samePage"))},this.onSamePageWithHash=t=>{this.maybeScrollToAnchor(t.delegateTarget.hash,"samePageWithHash")},this.onTransitionStart=t=>{this.options.doScrollingRightAway&&!this.swup.scrollToElement&&this.doScrollingBetweenPages(t)},this.onContentReplaced=t=>{this.options.doScrollingRightAway&&!this.swup.scrollToElement||this.doScrollingBetweenPages(t),this.restoreScrollContainers(t)},this.doScrollingBetweenPages=t=>{const o=this.swup;if(t&&!o.options.animateHistoryBrowsing)return;if(this.maybeScrollToAnchor(o.scrollToElement,"betweenPages"))return void(o.scrollToElement=null);const e=this.getStoredScrollPositions(this.getCurrentCacheKey())||{},s=e.window&&e.window.top||0;requestAnimationFrame(()=>o.scrollTo(s,this.shouldAnimate("betweenPages")))},this.onWillReplaceContent=()=>{this.storeScrollPositions(this.currentCacheKey),this.currentCacheKey=this.getCurrentCacheKey()},this.onClickLink=t=>{this.maybeResetScrollPositions(t.delegateTarget)},this.options={doScrollingRightAway:!1,animateScroll:{betweenPages:!0,samePageWithHash:!0,samePage:!0},scrollFriction:.3,scrollAcceleration:.04,getAnchorElement:null,offset:0,scrollContainers:"[data-swup-scroll-container]",shouldResetScrollPosition:t=>!0,...t}}mount(){var t=this;const o=this.swup;o._handlers.scrollDone=[],o._handlers.scrollStart=[],this.scrl=new n({onStart:()=>o.triggerEvent("scrollStart"),onEnd:()=>o.triggerEvent("scrollDone"),onCancel:()=>o.triggerEvent("scrollDone"),friction:this.options.scrollFriction,acceleration:this.options.scrollAcceleration}),o.scrollTo=function(e,s){void 0===s&&(s=!0),s?t.scrl.scrollTo(e):(o.triggerEvent("scrollStart"),window.scrollTo(0,e),o.triggerEvent("scrollDone"))},this.scrollPositionsStore={},this.currentCacheKey=this.getCurrentCacheKey(),this.previousScrollRestoration=window.history.scrollRestoration,o.options.animateHistoryBrowsing&&(window.history.scrollRestoration="manual"),o.on("samePage",this.onSamePage),o.on("samePageWithHash",this.onSamePageWithHash),o.on("transitionStart",this.onTransitionStart),o.on("contentReplaced",this.onContentReplaced),o.on("willReplaceContent",this.onWillReplaceContent),o.on("clickLink",this.onClickLink)}unmount(){const t=this.swup;t.scrollTo=null,delete this.scrl,this.scrl=null,t.off("samePage",this.onSamePage),t.off("samePageWithHash",this.onSamePageWithHash),t.off("transitionStart",this.onTransitionStart),t.off("contentReplaced",this.onContentReplaced),t.off("willReplaceContent",this.onWillReplaceContent),t.off("clickLink",this.onClickLink),t._handlers.scrollDone=null,t._handlers.scrollStart=null,window.history.scrollRestoration=this.previousScrollRestoration}shouldAnimate(t){return"boolean"==typeof this.options.animateScroll?this.options.animateScroll:this.options.animateScroll[t]}maybeScrollToAnchor(t,o){if(null==t)return!1;const e=this.getAnchorElement(t);if(!e)return console.warn(`Element ${t} not found`),!1;if(!(e instanceof Element))return console.warn(`Element ${t} is not a DOM node`),!1;const s=e.getBoundingClientRect().top+window.pageYOffset-this.getOffset(e);return this.swup.scrollTo(s,this.shouldAnimate(o)),!0}maybeResetScrollPositions(t){if(!this.options.shouldResetScrollPosition(t))return;const{url:e}=o.fromElement(t);this.resetScrollPositions(e)}storeScrollPositions(t){const o=e(this.options.scrollContainers).map(t=>({top:t.scrollTop,left:t.scrollLeft}));this.scrollPositionsStore[t]={window:{top:window.scrollY,left:window.scrollX},containers:o}}resetScrollPositions(t){const o=this.getResolvedUrl(t);delete this.scrollPositionsStore[o],this.scrollPositionsStore[o]=null}getStoredScrollPositions(t){const o=this.getResolvedUrl(t);return this.scrollPositionsStore[o]}restoreScrollContainers(t){const o=this.getStoredScrollPositions(this.getCurrentCacheKey())||{};null!=o.containers&&e(this.options.scrollContainers).forEach((t,e)=>{const s=o.containers[e];null!=s&&(t.scrollTop=s.top,t.scrollLeft=s.left)})}getCurrentCacheKey(){return this.getResolvedUrl(s())}getResolvedUrl(t){return"function"==typeof this.swup.resolveUrl?this.swup.resolveUrl(t):t}}export{i as default};
//# sourceMappingURL=index.module.js.map
